# ì‚¬ì¹´ë¦° (GemOphia) ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

> AI ê¸°ë°˜ ì¢…í•© ê´€ê³„ ê´€ë¦¬ í”Œë«í¼
> ìŒì„±ëŒ€í™”ì™€ í…ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ í™œìš©í•œ ì •ë³´ ê¸°ë¡, ì¼ì • ìë™ ë“±ë¡, ëŒ€í™” ì£¼ì œ ì œì•ˆ, ê´€ê³„ ì‹¬í™” í™œë™ ìƒì„±

---

## ğŸ“‹ ëª©ì°¨

1. [ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì „ì²´-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
2. [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ](#ë°ì´í„°ë² ì´ìŠ¤-ìŠ¤í‚¤ë§ˆ)
3. [AI ì„œë¹„ìŠ¤ íŒŒì´í”„ë¼ì¸](#ai-ì„œë¹„ìŠ¤-íŒŒì´í”„ë¼ì¸)
4. [ë°ì´í„° íë¦„](#ë°ì´í„°-íë¦„)
5. [í•µì‹¬ ê¸°ëŠ¥ë³„ êµ¬í˜„](#í•µì‹¬-ê¸°ëŠ¥ë³„-êµ¬í˜„)
6. [ê¸°ìˆ  ìŠ¤íƒ](#ê¸°ìˆ -ìŠ¤íƒ)
7. [ë³´ì•ˆ ë° í”„ë¼ì´ë²„ì‹œ](#ë³´ì•ˆ-ë°-í”„ë¼ì´ë²„ì‹œ)

---

## ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Flutter ì•± (ì‚¬ì¹´ë¦°)                              â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ ìŒì„±/í…ìŠ¤íŠ¸  â”‚  â”‚ ìŠ¤ë§ˆíŠ¸ ì¼ì •  â”‚  â”‚ ê´€ê³„ ì¸ì‚¬ì´íŠ¸â”‚               â”‚
â”‚  â”‚ ë©”ì‹œì§€ ì…ë ¥  â”‚  â”‚ ê´€ë¦¬         â”‚  â”‚ ëŒ€ì‹œë³´ë“œ     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ ëŒ€í™” ì£¼ì œ    â”‚  â”‚ ê´€ê³„ ë°œì „    â”‚  â”‚ ê°ì • íŠ¸ë Œë“œ  â”‚               â”‚
â”‚  â”‚ ì¶”ì²œ í™”ë©´    â”‚  â”‚ í™œë™ ì œì•ˆ    â”‚  â”‚ ì°¨íŠ¸         â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
    â”‚                       â”‚                   â”‚                   â”‚
    â”‚ INSERT                â”‚ Realtime êµ¬ë…      â”‚ SELECT           â”‚
    v                       v                   v                   v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Supabase (PostgreSQL + Realtime)                      â”‚
â”‚                                                                       â”‚
â”‚  [ë©”ì‹œì§€ & ë¶„ì„]         [ì¼ì • & ê¸°ë…ì¼]       [ê´€ê³„ ë°œì „]           â”‚
â”‚  â€¢ messages              â€¢ schedules           â€¢ conversation_topicsâ”‚
â”‚  â€¢ analysis_results      â€¢ anniversaries       â€¢ activities         â”‚
â”‚  â€¢ conversation_summariesâ€¢ calendar_events     â€¢ topic_history      â”‚
â”‚                                                                       â”‚
â”‚  [ê°ì • & íŠ¸ë Œë“œ]         [ì„ í˜¸ë„ í•™ìŠµ]         [ê´€ê³„ ê±´ê°•]           â”‚
â”‚  â€¢ emotion_trends        â€¢ user_preferences    â€¢ relationship_healthâ”‚
â”‚  â€¢ conversation_analysis â€¢ ner_extractions     â€¢ conflict_alerts    â”‚
â”‚                                                                       â”‚
â”‚  â€» ì´ 15ê°œ í…Œì´ë¸” (ì•„ë˜ ìƒì„¸ ìŠ¤í‚¤ë§ˆ ì°¸ì¡°)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ Realtime êµ¬ë… (messages, schedules ë“±)
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ë¡œì»¬ AI ë°±ì—”ë“œ (ë…ë¦½ Python í”„ë¡œì„¸ìŠ¤)                    â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  listener.py (ë…ë¦½ ì‹¤í–‰)                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ messages í…Œì´ë¸” êµ¬ë… â†’ ë©”ì‹œì§€ ë¶„ì„ íŒŒì´í”„ë¼ì¸ íŠ¸ë¦¬ê±°         â”‚ â”‚
â”‚  â”‚  â”œâ”€ ì¼ë³„ ë°°ì¹˜ ì‘ì—… (23:59) â†’ ëŒ€í™” ìš”ì•½ & ê´€ê³„ ë¶„ì„              â”‚ â”‚
â”‚  â”‚  â””â”€ ì£¼ê°„ ë°°ì¹˜ ì‘ì—… (ì¼ìš”ì¼) â†’ ê°ì • íŠ¸ë Œë“œ & ì£¼ì œ ì¶”ì²œ           â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  â€» FastAPIëŠ” ë³„ë„ (í•„ìš”ì‹œ API ì—”ë“œí¬ì¸íŠ¸ ì œê³µìš©)                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ¤ ìŒì„±/í…ìŠ¤íŠ¸ ì²˜ë¦¬ ë ˆì´ì–´                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ STT Service (Hugging Face Whisper)                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ NER Service (KoBERT) - ë‚ ì§œ, ì¥ì†Œ, í™œë™ ì¶”ì¶œ                â”‚ â”‚
â”‚  â”‚  â””â”€ Auto-Schedule Generator - ì¼ì • ìë™ ìƒì„±                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â†“                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ§  ê°ì • ë¶„ì„ ë ˆì´ì–´                                             â”‚ â”‚
â”‚  â”‚  â”œâ”€ Emotion Analyzer (Gemini API)                               â”‚ â”‚
â”‚  â”‚  â”‚   - 7ê°€ì§€ ê°ì • ë¶„ì„ (ê¸°ì¨, ìŠ¬í””, í™”ë‚¨, ë¶ˆì•ˆ, ì¤‘ë¦½, ì‚¬ë‘, í”¼ê³¤)â”‚ â”‚
â”‚  â”‚  â”œâ”€ Multimodal Analyzer (ìŒì„± í†¤ + í…ìŠ¤íŠ¸)                      â”‚ â”‚
â”‚  â”‚  â””â”€ Emotion Trend Analyzer (ì£¼ê°„/ì›”ê°„ íŠ¸ë Œë“œ)                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â†“                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ’¬ ëŒ€í™” ë¶„ì„ ë ˆì´ì–´                                             â”‚ â”‚
â”‚  â”‚  â”œâ”€ LSM Analyzer (Kiwipiepy) - ëŒ€í™” ìŠ¤íƒ€ì¼ ìœ ì‚¬ë„               â”‚ â”‚
â”‚  â”‚  â”œâ”€ Turn-Taking Analyzer - ëŒ€í™” ê· í˜• ë¶„ì„                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ Conversation Summarizer (KoBART) - ëŒ€í™” ìš”ì•½                â”‚ â”‚
â”‚  â”‚  â””â”€ Keyword Extractor (TextRank) - í•µì‹¬ í‚¤ì›Œë“œ ì¶”ì¶œ             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â†“                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸš€ LLM ê¸°ë°˜ ê´€ê³„ ë°œì „ ë ˆì´ì–´                                    â”‚ â”‚
â”‚  â”‚  â”œâ”€ Topic Generator (GPT-4)                                     â”‚ â”‚
â”‚  â”‚  â”‚   - ëŒ€í™” ì´ë ¥ ë¶„ì„ â†’ ë¯¸íƒìƒ‰ ì£¼ì œ ë°œê²¬                        â”‚ â”‚
â”‚  â”‚  â”‚   - ê´€ê³„ ë‹¨ê³„ë³„ ë§ì¶¤í˜• ì§ˆë¬¸ ìƒì„±                             â”‚ â”‚
â”‚  â”‚  â”œâ”€ Activity Recommender (GPT-4)                                â”‚ â”‚
â”‚  â”‚  â”‚   - ë¶€ì¡±í•œ ëŒ€í™” ì˜ì—­ íŒŒì•… â†’ ê´€ê³„ ì‹¬í™” í™œë™ ì œì•ˆ              â”‚ â”‚
â”‚  â”‚  â”‚   - ëª©ì , ì¤€ë¹„ë¬¼, ë‹¨ê³„ë³„ ê°€ì´ë“œ ì œê³µ                         â”‚ â”‚
â”‚  â”‚  â””â”€ Relationship Coach (GPT-4)                                  â”‚ â”‚
â”‚  â”‚      - ê´€ê³„ ê±´ê°•ë„ ê³„ì‚° (ê°ì • 40% + LSM 30% + ê· í˜• 30%)         â”‚ â”‚
â”‚  â”‚      - ì¡°ê¸° ê²½ê³  ì‹œìŠ¤í…œ (ë¶€ì • ê°ì • ëˆ„ì  ê°ì§€)                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â†“                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ“Š ë¶„ì„ ê²°ê³¼ ì €ì¥                                               â”‚ â”‚
â”‚  â”‚  - analysis_results, conversation_analysis, emotion_trends      â”‚ â”‚
â”‚  â”‚  - conversation_topics, activities, relationship_health         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### 1ï¸âƒ£ ë©”ì‹œì§€ & ë¶„ì„ í…Œì´ë¸”

```sql
-- ============================================================
-- ë©”ì‹œì§€ í…Œì´ë¸” (ì›ë³¸ ë°ì´í„°)
-- ============================================================
CREATE TABLE messages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID NOT NULL,
  sender_id UUID NOT NULL,
  content TEXT NOT NULL,
  message_type VARCHAR(20) DEFAULT 'text',  -- 'text', 'voice', 'auto_schedule'
  voice_tone_features JSONB,                -- ìŒì„± í†¤, ì†ë„ ë“± (ë©€í‹°ëª¨ë‹¬ ë¶„ì„ìš©)
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_messages_couple_time ON messages(couple_id, created_at DESC);
CREATE INDEX idx_messages_sender ON messages(sender_id, created_at DESC);


-- ============================================================
-- ê°œì²´ëª… ì¶”ì¶œ ê²°ê³¼ (NER)
-- ============================================================
CREATE TABLE ner_extractions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  message_id UUID REFERENCES messages(id) ON DELETE CASCADE,
  entity_type VARCHAR(50),  -- 'DATE', 'LOCATION', 'ACTIVITY', 'PERSON'
  entity_value TEXT,
  confidence DECIMAL(3,2),
  extracted_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_ner_message ON ner_extractions(message_id);
CREATE INDEX idx_ner_type ON ner_extractions(entity_type);


-- ============================================================
-- ê°ì • ë¶„ì„ ê²°ê³¼ (ë©”ì‹œì§€ë³„)
-- ============================================================
CREATE TABLE analysis_results (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  message_id UUID REFERENCES messages(id) ON DELETE CASCADE,
  emotion VARCHAR(50),           -- ì£¼ìš” ê°ì • ("ê¸°ì¨", "ìŠ¬í””" ë“±)
  confidence DECIMAL(3,2),       -- í™•ì‹ ë„ (0.00 ~ 1.00)
  all_scores JSONB,              -- {"ê¸°ì¨": 0.89, "ìŠ¬í””": 0.02, ...}
  voice_emotion JSONB,           -- ìŒì„± ê¸°ë°˜ ê°ì • (ë©€í‹°ëª¨ë‹¬)
  topics TEXT[],                 -- ëŒ€í™” ì£¼ì œ íƒœê·¸
  keywords TEXT[],               -- TextRankë¡œ ì¶”ì¶œí•œ í‚¤ì›Œë“œ
  processed_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_analysis_message ON analysis_results(message_id);
CREATE INDEX idx_analysis_emotion ON analysis_results(emotion, processed_at DESC);


-- ============================================================
-- ëŒ€í™” ìš”ì•½ (ì¼ë³„)
-- ============================================================
CREATE TABLE conversation_summaries (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID NOT NULL,
  summary_date DATE NOT NULL,
  summary_text TEXT,                    -- KoBARTë¡œ ìƒì„±í•œ ìš”ì•½
  key_moments TEXT[],                   -- í•˜ì´ë¼ì´íŠ¸ ë¬¸ì¥ë“¤
  total_messages INT,
  total_words INT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(couple_id, summary_date)
);

CREATE INDEX idx_summaries_couple_date ON conversation_summaries(couple_id, summary_date DESC);


-- ============================================================
-- ëŒ€í™” ë¶„ì„ (ì¼ë³„ ì¢…í•©)
-- ============================================================
CREATE TABLE conversation_analysis (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID NOT NULL,
  analysis_date DATE NOT NULL,

  -- ê°ì • ìš”ì•½
  emotion_summary JSONB,         -- {"ê¸ì •": 0.65, "ì¤‘ë¦½": 0.25, "ë¶€ì •": 0.10}
  dominant_emotion VARCHAR(50),  -- ê°€ì¥ ë§ì´ ë‚˜íƒ€ë‚œ ê°ì •

  -- LSM ë¶„ì„
  lsm_score DECIMAL(3,2),        -- Language Style Matching (0.00 ~ 1.00)
  lsm_details JSONB,             -- ì¹´í…Œê³ ë¦¬ë³„ ìƒì„¸ ì ìˆ˜

  -- í„´í…Œì´í‚¹ ë¶„ì„
  turn_taking JSONB,             -- {"balance_score": 95.0, "turn_ratio": 0.475, ...}

  -- ê´€ê³„ ê±´ê°•ë„
  relationship_health DECIMAL(5,2),  -- 0 ~ 100

  -- ê°ˆë“± ê°ì§€
  conflict_detected BOOLEAN DEFAULT FALSE,
  conflict_intensity DECIMAL(3,2),

  -- í‚¤ì›Œë“œ
  keywords TEXT[],

  analyzed_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(couple_id, analysis_date)
);

CREATE INDEX idx_conversation_couple_date ON conversation_analysis(couple_id, analysis_date DESC);


-- ============================================================
-- ê°ì • íŠ¸ë Œë“œ (ì£¼ê°„/ì›”ê°„ ì§‘ê³„)
-- ============================================================
CREATE TABLE emotion_trends (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID NOT NULL,
  period_type VARCHAR(20),       -- 'weekly', 'monthly'
  period_start DATE NOT NULL,
  period_end DATE NOT NULL,

  emotion_distribution JSONB,    -- 7ê°€ì§€ ê°ì •ë³„ ë¹„ìœ¨
  trend_direction VARCHAR(20),   -- 'improving', 'stable', 'declining'
  positive_ratio_change DECIMAL(5,2),  -- ê¸ì • ê°ì • ë³€í™”ìœ¨ (%)

  analyzed_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(couple_id, period_type, period_start)
);

CREATE INDEX idx_trends_couple ON emotion_trends(couple_id, period_start DESC);
```

### 2ï¸âƒ£ ì¼ì • & ê¸°ë…ì¼ í…Œì´ë¸”

```sql
-- ============================================================
-- ìë™ ìƒì„± ì¼ì •
-- ============================================================
CREATE TABLE schedules (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID NOT NULL,
  created_by UUID,               -- ì¼ì •ì„ ë§Œë“  ì‚¬ëŒ (NULLì´ë©´ AI ìë™ ìƒì„±)
  source_message_id UUID REFERENCES messages(id),  -- ì¶œì²˜ ë©”ì‹œì§€

  title VARCHAR(200),
  description TEXT,
  location VARCHAR(200),
  scheduled_at TIMESTAMP WITH TIME ZONE,
  duration_minutes INT,

  is_auto_generated BOOLEAN DEFAULT FALSE,
  confirmation_status VARCHAR(20) DEFAULT 'pending',  -- 'pending', 'confirmed', 'rejected'

  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_schedules_couple ON schedules(couple_id, scheduled_at);
CREATE INDEX idx_schedules_status ON schedules(confirmation_status);


-- ============================================================
-- ê¸°ë…ì¼ ê´€ë¦¬
-- ============================================================
CREATE TABLE anniversaries (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID NOT NULL,
  anniversary_type VARCHAR(50),  -- 'first_day', '100days', '200days', '1year', 'birthday', 'custom'
  title VARCHAR(200),
  base_date DATE NOT NULL,       -- ê¸°ì¤€ì¼ (ì—°ì•  ì‹œì‘ì¼, ìƒì¼ ë“±)
  is_lunar BOOLEAN DEFAULT FALSE,-- ìŒë ¥ ì—¬ë¶€
  day_count INT,                 -- D+100, D+200 ë“±
  recurrence VARCHAR(20),        -- 'once', 'yearly', 'monthly'

  reminder_days INT[] DEFAULT ARRAY[7, 3, 1],  -- ë©°ì¹  ì „ì— ì•Œë¦¼

  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_anniversaries_couple ON anniversaries(couple_id, base_date);


-- ============================================================
-- ìº˜ë¦°ë” ì´ë²¤íŠ¸ (ê³„ì ˆë³„ ì¶”ì²œ ë“±)
-- ============================================================
CREATE TABLE calendar_events (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID,                -- NULLì´ë©´ ì „ì²´ ì»¤í”Œ ëŒ€ìƒ
  event_type VARCHAR(50),        -- 'season', 'holiday', 'recommendation'
  title VARCHAR(200),
  description TEXT,
  suggested_date DATE,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_calendar_couple ON calendar_events(couple_id, suggested_date);
```

### 3ï¸âƒ£ ê´€ê³„ ë°œì „ í…Œì´ë¸”

```sql
-- ============================================================
-- ëŒ€í™” ì£¼ì œ ì¶”ì²œ (LLM ìƒì„±)
-- ============================================================
CREATE TABLE conversation_topics (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID NOT NULL,

  topic_category VARCHAR(100),   -- 'ë¯¸ë˜ ê³„íš', 'ê°€ì¡±', 'ê°€ì¹˜ê´€', 'ì¶”ì–µ' ë“±
  topic_title VARCHAR(200),
  core_question TEXT,            -- í•µì‹¬ ì§ˆë¬¸
  context_explanation TEXT,      -- ì™œ ì§€ê¸ˆ ì´ ì£¼ì œê°€ ì¤‘ìš”í•œì§€
  guide_questions TEXT[],        -- ì„¸ë¶€ ê°€ì´ë“œ ì§ˆë¬¸ 3-5ê°œ

  conversation_depth_level INT,  -- 1~5 (ì–¼ë§ˆë‚˜ ê¹Šì€ ëŒ€í™”ì¸ì§€)
  estimated_time_minutes INT,    -- ì˜ˆìƒ ì†Œìš” ì‹œê°„

  generated_by VARCHAR(50) DEFAULT 'gpt-4',
  status VARCHAR(20) DEFAULT 'suggested',  -- 'suggested', 'in_progress', 'completed', 'skipped'

  suggested_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  completed_at TIMESTAMP WITH TIME ZONE
);

CREATE INDEX idx_topics_couple ON conversation_topics(couple_id, suggested_at DESC);
CREATE INDEX idx_topics_status ON conversation_topics(status);


-- ============================================================
-- ì£¼ì œ íƒìƒ‰ ê¸°ë¡
-- ============================================================
CREATE TABLE topic_history (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID NOT NULL,
  topic_category VARCHAR(100),
  last_discussed_at TIMESTAMP WITH TIME ZONE,
  discussion_count INT DEFAULT 0,
  depth_score DECIMAL(3,2),      -- ì–¼ë§ˆë‚˜ ê¹Šì´ ëŒ€í™”í–ˆëŠ”ì§€ (0 ~ 1)

  UNIQUE(couple_id, topic_category)
);

CREATE INDEX idx_topic_history_couple ON topic_history(couple_id, last_discussed_at DESC);


-- ============================================================
-- ê´€ê³„ ë°œì „ í™œë™ ì¶”ì²œ
-- ============================================================
CREATE TABLE activities (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID NOT NULL,

  activity_title VARCHAR(200),
  activity_purpose TEXT,         -- ì´ í™œë™ì˜ ëª©ì  (ì˜ˆ: "ì„œë¡œì˜ ê°€ì¹˜ê´€ ì´í•´")
  category VARCHAR(100),         -- 'ëŒ€í™” ì´‰ì§„', 'ì¶”ì–µ ë§Œë“¤ê¸°', 'ê°ì • í‘œí˜„' ë“±

  preparation_items TEXT[],      -- ì¤€ë¹„ë¬¼
  step_by_step_guide JSONB,      -- ë‹¨ê³„ë³„ ì§„í–‰ ë°©ë²•
  expected_outcome TEXT,         -- ê¸°ëŒ€ íš¨ê³¼

  difficulty_level INT,          -- 1~5
  estimated_time_minutes INT,

  generated_by VARCHAR(50) DEFAULT 'gpt-4',
  status VARCHAR(20) DEFAULT 'suggested',  -- 'suggested', 'in_progress', 'completed', 'skipped'

  suggested_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  completed_at TIMESTAMP WITH TIME ZONE,
  feedback_rating INT,           -- 1~5 (ì‹¤í–‰ í›„ ì‚¬ìš©ì í‰ê°€)
  feedback_text TEXT
);

CREATE INDEX idx_activities_couple ON activities(couple_id, suggested_at DESC);
CREATE INDEX idx_activities_status ON activities(status);
```

### 4ï¸âƒ£ ê´€ê³„ ê±´ê°• & í•™ìŠµ í…Œì´ë¸”

```sql
-- ============================================================
-- ê´€ê³„ ê±´ê°•ë„ ì ìˆ˜ (ì¼ë³„ ì¶”ì )
-- ============================================================
CREATE TABLE relationship_health (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID NOT NULL,
  health_date DATE NOT NULL,

  total_score DECIMAL(5,2),      -- 0 ~ 100
  emotion_score DECIMAL(5,2),    -- ê°ì • ì ìˆ˜ (40% ê°€ì¤‘ì¹˜)
  lsm_score DECIMAL(5,2),        -- LSM ì ìˆ˜ (30% ê°€ì¤‘ì¹˜)
  balance_score DECIMAL(5,2),    -- í„´í…Œì´í‚¹ ê· í˜• (30% ê°€ì¤‘ì¹˜)

  trend VARCHAR(20),             -- 'improving', 'stable', 'declining'

  calculated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(couple_id, health_date)
);

CREATE INDEX idx_health_couple ON relationship_health(couple_id, health_date DESC);


-- ============================================================
-- ê°ˆë“± ì¡°ê¸° ê²½ê³ 
-- ============================================================
CREATE TABLE conflict_alerts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID NOT NULL,

  alert_type VARCHAR(50),        -- 'negative_trend', 'reduced_communication', 'shallow_conversations'
  severity VARCHAR(20),          -- 'low', 'medium', 'high'
  description TEXT,
  recommended_actions JSONB,     -- ì¶”ì²œ í™œë™ë“¤

  detected_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  resolved_at TIMESTAMP WITH TIME ZONE,
  is_resolved BOOLEAN DEFAULT FALSE
);

CREATE INDEX idx_alerts_couple ON conflict_alerts(couple_id, detected_at DESC);
CREATE INDEX idx_alerts_unresolved ON conflict_alerts(is_resolved, detected_at DESC);


-- ============================================================
-- ì‚¬ìš©ì ì„ í˜¸ë„ í•™ìŠµ
-- ============================================================
CREATE TABLE user_preferences (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL,

  preference_type VARCHAR(50),   -- 'food', 'movie_genre', 'activity', 'music', 'travel'
  preference_value TEXT,
  confidence DECIMAL(3,2),       -- í•™ìŠµ í™•ì‹ ë„

  learned_from_message_id UUID REFERENCES messages(id),
  learned_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),

  UNIQUE(user_id, preference_type, preference_value)
);

CREATE INDEX idx_preferences_user ON user_preferences(user_id, preference_type);
```

---

## AI ì„œë¹„ìŠ¤ íŒŒì´í”„ë¼ì¸

### ğŸ“Œ íŒŒì´í”„ë¼ì¸ 1: ì‹¤ì‹œê°„ ë©”ì‹œì§€ ë¶„ì„

```
ìƒˆ ë©”ì‹œì§€ INSERT
    â†“
Realtime Listener ê°ì§€
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. STT (ìŒì„±ì¼ ê²½ìš°)         â”‚
â”‚    - Hugging Face Whisper   â”‚
â”‚    - ìŒì„± í†¤ ì¶”ì¶œ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. NER (ê°œì²´ëª… ì¸ì‹)         â”‚
â”‚    - KoBERT                 â”‚
â”‚    - ë‚ ì§œ, ì¥ì†Œ, í™œë™ ì¶”ì¶œ   â”‚
â”‚    â†’ ner_extractions ì €ì¥   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ì¼ì • ìë™ ìƒì„± (í•„ìš”ì‹œ)   â”‚
â”‚    - NER ê²°ê³¼ ë¶„ì„          â”‚
â”‚    â†’ schedules ì €ì¥         â”‚
â”‚    - confirmation_status:   â”‚
â”‚      'pending'              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ê°ì • ë¶„ì„ (Multimodal)   â”‚
â”‚    - í…ìŠ¤íŠ¸: Gemini API     â”‚
â”‚    - ìŒì„±: í†¤ ë¶„ì„          â”‚
â”‚    â†’ analysis_results ì €ì¥  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Flutter ì•± Realtime ìˆ˜ì‹ 
```

### ğŸ“Œ íŒŒì´í”„ë¼ì¸ 2: ì¼ë³„ ëŒ€í™” ì¢…í•© ë¶„ì„ (23:59 ì‹¤í–‰)

```
ìŠ¤ì¼€ì¤„ëŸ¬ íŠ¸ë¦¬ê±°
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì˜¤ëŠ˜ì˜ ë©”ì‹œì§€ ì¡°íšŒ        â”‚
â”‚    - couple_idë³„ ê·¸ë£¹í•‘     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ëŒ€í™” ìš”ì•½ ìƒì„±            â”‚
â”‚    - KoBART                 â”‚
â”‚    â†’ conversation_summaries â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. LSM ë¶„ì„                 â”‚
â”‚    - Kiwipiepy í˜•íƒœì†Œ ë¶„ì„  â”‚
â”‚    - ëŒ€í™” ìŠ¤íƒ€ì¼ ìœ ì‚¬ë„     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. í„´í…Œì´í‚¹ ë¶„ì„             â”‚
â”‚    - ëŒ€í™” ê· í˜• ì ìˆ˜         â”‚
â”‚    - ì‘ë‹µ ì‹œê°„ ë¶„ì„         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ê´€ê³„ ê±´ê°•ë„ ê³„ì‚°          â”‚
â”‚    - ê°ì •(40%) + LSM(30%)   â”‚
â”‚      + ê· í˜•(30%)            â”‚
â”‚    â†’ conversation_analysis  â”‚
â”‚    â†’ relationship_health    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ê°ˆë“± ì¡°ê¸° ê²½ê³  ì²´í¬       â”‚
â”‚    - ë¶€ì • ê°ì • ëˆ„ì  ê°ì§€    â”‚
â”‚    - ëŒ€í™” ê°ì†Œ íŒ¨í„´ ê°ì§€    â”‚
â”‚    â†’ conflict_alerts        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Œ íŒŒì´í”„ë¼ì¸ 3: ì£¼ê°„ ê´€ê³„ ë°œì „ ì œì•ˆ (ì¼ìš”ì¼ ì‹¤í–‰)

```
ìŠ¤ì¼€ì¤„ëŸ¬ íŠ¸ë¦¬ê±°
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì£¼ê°„ ê°ì • íŠ¸ë Œë“œ ë¶„ì„     â”‚
â”‚    â†’ emotion_trends         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ëŒ€í™” íŒ¨í„´ ë¶„ì„            â”‚
â”‚    - topic_history ì—…ë°ì´íŠ¸ â”‚
â”‚    - ë¶€ì¡±í•œ ì£¼ì œ ì˜ì—­ íŒŒì•…  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. LLM ëŒ€í™” ì£¼ì œ ìƒì„±        â”‚
â”‚    - GPT-4 API              â”‚
â”‚    - ê´€ê³„ ë‹¨ê³„ ê³ ë ¤         â”‚
â”‚    - ë¯¸íƒìƒ‰ ì£¼ì œ ì œì•ˆ       â”‚
â”‚    â†’ conversation_topics    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ê´€ê³„ ë°œì „ í™œë™ ì¶”ì²œ       â”‚
â”‚    - GPT-4 API              â”‚
â”‚    - ë§ì¶¤í˜• í™œë™ ìƒì„±       â”‚
â”‚    â†’ activities             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Flutter ì•± ì•Œë¦¼ ì „ì†¡
```

---

## ë°ì´í„° íë¦„

### ì‹œë‚˜ë¦¬ì˜¤ 1: ìŒì„± ë©”ì‹œì§€ë¡œ ì¼ì • ì¡ê¸°

```
ì‚¬ìš©ì A: "ë‹¤ìŒ ì£¼ í† ìš”ì¼ 7ì‹œì— ê°•ë‚¨ì—­ì—ì„œ ì˜í™” ë³´ì"
    â†“
Flutter: ìŒì„± ë…¹ìŒ â†’ messages í…Œì´ë¸” INSERT
    (message_type: 'voice', voice_tone_features: {...})
    â†“
AI ë°±ì—”ë“œ Realtime Listener ê°ì§€
    â†“
STT Service: "ë‹¤ìŒ ì£¼ í† ìš”ì¼ 7ì‹œì— ê°•ë‚¨ì—­ì—ì„œ ì˜í™” ë³´ì"
    â†“
NER Service:
    - DATE: "ë‹¤ìŒ ì£¼ í† ìš”ì¼" â†’ 2025-01-25
    - TIME: "7ì‹œ" â†’ 19:00
    - LOCATION: "ê°•ë‚¨ì—­"
    - ACTIVITY: "ì˜í™”"
    â†“
Auto-Schedule Generator:
    schedules í…Œì´ë¸”ì— INSERT
    {
      title: "ì˜í™” ë³´ê¸°",
      location: "ê°•ë‚¨ì—­",
      scheduled_at: "2025-01-25 19:00",
      is_auto_generated: true,
      confirmation_status: 'pending'
    }
    â†“
Flutter ì•±: Realtimeìœ¼ë¡œ ì¼ì • ì œì•ˆ ìˆ˜ì‹ 
    â†’ ì‚¬ìš©ìì—ê²Œ í™•ì¸ ìš”ì²­ UI í‘œì‹œ
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ê°ì • íŠ¸ë Œë“œ í•˜ë½ ê°ì§€ â†’ ì¡°ê¸° ê²½ê³ 

```
ì¼ë³„ ë°°ì¹˜ ë¶„ì„ (ì›”~ì¼ 7ì¼ê°„)
    â†“
Trend Analyzer:
    - ì›”: ê¸ì • 70%, ë¶€ì • 10%
    - í™”: ê¸ì • 65%, ë¶€ì • 15%
    - ìˆ˜: ê¸ì • 60%, ë¶€ì • 20%
    - ëª©: ê¸ì • 55%, ë¶€ì • 25%
    - ê¸ˆ: ê¸ì • 50%, ë¶€ì • 30%  â† ë¶€ì • 30% ì´ˆê³¼!
    â†“
Conflict Alert ìƒì„±:
    conflict_alerts í…Œì´ë¸” INSERT
    {
      alert_type: 'negative_trend',
      severity: 'medium',
      description: 'ìµœê·¼ 5ì¼ê°„ ë¶€ì •ì ì¸ ê°ì •ì´ ì¦ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤',
      recommended_actions: [
        'ëŒ€í™” ì£¼ì œ: "ìš°ë¦¬ì—ê²Œ ì§€ê¸ˆ í•„ìš”í•œ ê²ƒì€?"',
        'í™œë™: "í•¨ê»˜ ì‚°ì±…í•˜ë©° ê°€ë²¼ìš´ ì´ì•¼ê¸° ë‚˜ëˆ„ê¸°"'
      ]
    }
    â†“
Flutter ì•±: í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ëŒ€í™” ì£¼ì œ ì œì•ˆ

```
ì£¼ê°„ ë°°ì¹˜ ë¶„ì„ (ì¼ìš”ì¼)
    â†“
Topic Analyzer:
    topic_history ë¶„ì„ ê²°ê³¼:
    - 'ì·¨ë¯¸': 10íšŒ (depth: 0.8)  âœ… ì¶©ë¶„
    - 'ì¼ìƒ': 15íšŒ (depth: 0.6)  âœ…
    - 'ë¯¸ë˜ ê³„íš': 2íšŒ (depth: 0.3)  âŒ ë¶€ì¡±!
    - 'ê°€ì¡±': 0íšŒ  âŒ ì—†ìŒ!
    â†“
GPT-4 Topic Generator:
    Input: {
      couple_history: "ì—°ì•  6ê°œì›”",
      discussed_topics: ['ì·¨ë¯¸', 'ì¼ìƒ'],
      missing_topics: ['ë¯¸ë˜ ê³„íš', 'ê°€ì¡±'],
      recent_emotion: 'ê¸ì • 60%',
      relationship_stage: 'early'
    }
    â†“
    Output: {
      topic_title: "ìš°ë¦¬ì˜ 10ë…„ í›„",
      core_question: "10ë…„ í›„ ìš°ë¦¬ëŠ” ì–´ë–¤ ëª¨ìŠµì¼ê¹Œìš”?",
      context: "ê´€ê³„ ì´ˆê¸°ì— ì„œë¡œì˜ ë¯¸ë˜ ë¹„ì „ì„ ê³µìœ í•˜ë©´...",
      guide_questions: [
        "10ë…„ í›„ ì–´ë–¤ ì¼ì„ í•˜ê³  ìˆì„ê¹Œìš”?",
        "ì–´ë””ì—ì„œ ì‚´ê³  ì‹¶ë‚˜ìš”?",
        "ê°€ì¥ ì´ë£¨ê³  ì‹¶ì€ ê²ƒì€?"
      ],
      depth_level: 4,
      estimated_time: 30
    }
    â†“
conversation_topics í…Œì´ë¸” INSERT
    â†“
Flutter ì•±: "ìƒˆë¡œìš´ ëŒ€í™” ì£¼ì œê°€ ë„ì°©í–ˆì–´ìš”!" ì•Œë¦¼
```

---

## í•µì‹¬ ê¸°ëŠ¥ë³„ êµ¬í˜„

### 1. ì •ë³´ ê´€ë¦¬ ì‹œìŠ¤í…œ

**ê¸°ìˆ  ìŠ¤íƒ:**
- STT: Hugging Face Whisper (ì˜¤í”ˆì†ŒìŠ¤)
- NER: KoBERT fine-tuned
- Keyword Extraction: LLM API

**êµ¬í˜„ íŒŒì¼:**
```
ai_backend/app/services/
â”œâ”€â”€ stt_service.py              # ìŒì„± â†’ í…ìŠ¤íŠ¸
â”œâ”€â”€ ner_service.py              # ê°œì²´ëª… ì¸ì‹
â”œâ”€â”€ auto_scheduler.py           # ì¼ì • ìë™ ìƒì„±
â””â”€â”€ keyword_extractor.py        # í‚¤ì›Œë“œ ì¶”ì¶œ
```

### 2. ìŠ¤ë§ˆíŠ¸ ì¼ì • ê´€ë¦¬

**ê¸°ëŠ¥:**
- ìë™ ì¼ì • ì¸ì‹ ë° ë“±ë¡
- í•œêµ­ì‹ ê¸°ë…ì¼ ê³„ì‚° (100ì¼, 200ì¼, 1000ì¼)
- ìŒë ¥ ìƒì¼ ì§€ì›
- ê³„ì ˆë³„ ì´ë²¤íŠ¸ ì¶”ì²œ

**êµ¬í˜„ íŒŒì¼:**
```
ai_backend/app/services/
â”œâ”€â”€ anniversary_calculator.py   # ê¸°ë…ì¼ ê³„ì‚°
â”œâ”€â”€ lunar_calendar.py           # ìŒë ¥ ë³€í™˜
â””â”€â”€ seasonal_recommender.py     # ê³„ì ˆ ì¶”ì²œ
```

### 3. ëŒ€í™” ë¶„ì„ ì—”ì§„

**ë©€í‹°ëª¨ë‹¬ ê°ì • ë¶„ì„:**
- í…ìŠ¤íŠ¸: KoBERT (F1-score 0.87 ëª©í‘œ)
- ìŒì„±: í†¤, ì†ë„ ë¶„ì„
- ìœµí•©: ê°€ì¤‘ í‰ê·  (í…ìŠ¤íŠ¸ 70% + ìŒì„± 30%)

**ëŒ€í™” ìš”ì•½:**
- KoBART (ì¶”ìƒì  ìš”ì•½)
- TextRank (í•µì‹¬ ë¬¸ì¥ ì¶”ì¶œ)

**êµ¬í˜„ íŒŒì¼:**
```
ai_backend/app/services/
â”œâ”€â”€ emotion_analyzer.py         # (ê¸°ì¡´)
â”œâ”€â”€ multimodal_analyzer.py      # ë©€í‹°ëª¨ë‹¬ ìœµí•©
â”œâ”€â”€ conversation_summarizer.py  # KoBART ìš”ì•½
â””â”€â”€ textrank_extractor.py       # í•µì‹¬ ë¬¸ì¥
```

### 4. ê´€ê³„ ê¹Šì´ í™•ì¥ ì‹œìŠ¤í…œ

**LLM í”„ë¡¬í”„íŠ¸ êµ¬ì¡°:**
```python
TOPIC_GENERATION_PROMPT = """
ë‹¹ì‹ ì€ ì»¤í”Œ ê´€ê³„ ì „ë¬¸ ìƒë‹´ì‚¬ì…ë‹ˆë‹¤.

ì»¤í”Œ ì •ë³´:
- ê´€ê³„ ê¸°ê°„: {relationship_duration}
- ìµœê·¼ ëŒ€í™” ì£¼ì œ: {recent_topics}
- ì•„ì§ ë‚˜ëˆ„ì§€ ì•Šì€ ì£¼ì œ: {missing_topics}
- ìµœê·¼ ê°ì • ìƒíƒœ: {emotion_summary}
- ê´€ê³„ ë‹¨ê³„: {relationship_stage}

ìœ„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì´ ì»¤í”Œì—ê²Œ ì§€ê¸ˆ ê°€ì¥ í•„ìš”í•œ ëŒ€í™” ì£¼ì œë¥¼ ì œì•ˆí•˜ì„¸ìš”.

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{
  "topic_title": "ì£¼ì œ ì œëª©",
  "topic_category": "ì¹´í…Œê³ ë¦¬ (ë¯¸ë˜ ê³„íš, ê°€ì¡±, ê°€ì¹˜ê´€ ë“±)",
  "core_question": "í•µì‹¬ ì§ˆë¬¸",
  "context_explanation": "ì™œ ì§€ê¸ˆ ì´ ì£¼ì œê°€ ì¤‘ìš”í•œì§€",
  "guide_questions": ["ì§ˆë¬¸1", "ì§ˆë¬¸2", "ì§ˆë¬¸3"],
  "conversation_depth_level": 1~5,
  "estimated_time_minutes": ì˜ˆìƒ ì‹œê°„
}
"""
```

**êµ¬í˜„ íŒŒì¼:**
```
ai_backend/app/services/
â”œâ”€â”€ topic_generator.py          # GPT-4 ì£¼ì œ ìƒì„±
â”œâ”€â”€ activity_recommender.py     # GPT-4 í™œë™ ì¶”ì²œ
â””â”€â”€ relationship_coach.py       # ì¢…í•© ì½”ì¹­
```

### 5. ì˜ˆë°©ì  ê´€ê³„ ì¼€ì–´

**ì¡°ê¸° ê²½ê³  ì¡°ê±´:**
1. ë¶€ì • ê°ì • 30% ì´ˆê³¼ (3ì¼ ì—°ì†)
2. ì¼ì¼ ëŒ€í™”ëŸ‰ 50% ê°ì†Œ (1ì£¼ì¼ í‰ê·  ëŒ€ë¹„)
3. ëŒ€í™” ê¹Šì´ 0.3 ì´í•˜ (1ì£¼ì¼ í‰ê· )
4. LSM ì ìˆ˜ 0.4 ì´í•˜

**êµ¬í˜„ íŒŒì¼:**
```
ai_backend/app/services/
â”œâ”€â”€ trend_analyzer.py           # íŠ¸ë Œë“œ ë¶„ì„
â”œâ”€â”€ conflict_detector.py        # ê°ˆë“± ê°ì§€
â””â”€â”€ early_warning.py            # ì¡°ê¸° ê²½ê³ 
```

---

## ê¸°ìˆ  ìŠ¤íƒ

### Frontend (Flutter)
```yaml
dependencies:
  get: ^4.7.2                    # ìƒíƒœê´€ë¦¬
  supabase_flutter: ^2.9.1       # Supabase í´ë¼ì´ì–¸íŠ¸
  flutter_dotenv: ^5.2.1         # í™˜ê²½ë³€ìˆ˜

  # UI
  google_fonts: ^6.2.1
  flutter_screenutil: ^5.9.3
  fl_chart: ^0.69.0              # ê°ì • íŠ¸ë Œë“œ ì°¨íŠ¸
  table_calendar: ^3.1.3         # ìº˜ë¦°ë”

  # ìŒì„±
  record: ^5.0.0                 # ìŒì„± ë…¹ìŒ
  audioplayers: ^5.2.0           # ìŒì„± ì¬ìƒ
```

### Backend (AI)
```txt
# Web Framework
fastapi==0.115.0
uvicorn[standard]==0.32.0

# Database
supabase==2.9.1

# AI APIs
google-generativeai==0.8.3      # Gemini
openai==1.54.0                  # GPT-4

# NLP - Korean
kiwipiepy==0.18.0               # í˜•íƒœì†Œ ë¶„ì„
transformers==4.40.0            # KoBERT, KoBART
sentence-transformers==3.2.0    # Embeddings

# STT
openai-whisper==20231117        # Whisper (ë¡œì»¬)
# ë˜ëŠ” Hugging Face transformers

# Utils
python-dotenv==1.0.1
redis==5.2.0                    # ìºì‹±
apscheduler==3.10.4             # ìŠ¤ì¼€ì¤„ëŸ¬
```

### Infrastructure
- **Database**: Supabase (PostgreSQL 15)
- **Realtime**: Supabase Realtime (WebSocket)
- **Cache**: Redis (ì„ íƒì‚¬í•­)
- **Scheduler**: APScheduler (ë°°ì¹˜ ì‘ì—…)

---

## ë³´ì•ˆ ë° í”„ë¼ì´ë²„ì‹œ

### Row Level Security (RLS)

```sql
-- messages í…Œì´ë¸”
CREATE POLICY "Users can view their couple's messages"
  ON messages FOR SELECT
  USING (
    couple_id IN (
      SELECT couple_id FROM user_couples
      WHERE user_id = auth.uid()
    )
  );

CREATE POLICY "Users can insert to their couple's messages"
  ON messages FOR INSERT
  WITH CHECK (
    sender_id = auth.uid() AND
    couple_id IN (
      SELECT couple_id FROM user_couples
      WHERE user_id = auth.uid()
    )
  );

-- ë‹¤ë¥¸ í…Œì´ë¸”ë„ ìœ ì‚¬í•˜ê²Œ couple_id ê¸°ë°˜ RLS ì ìš©
```

### ë°ì´í„° ë³´ì•ˆ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flutter ì•± (ì‚¬ìš©ì ë””ë°”ì´ìŠ¤)            â”‚
â”‚  â”œâ”€ ë¡œì»¬ ìŒì„± ì „ì²˜ë¦¬                    â”‚
â”‚  â”œâ”€ End-to-End ì•”í˜¸í™”                   â”‚
â”‚  â””â”€ ìµœì†Œ ê¶Œí•œ ì›ì¹™ (Anon Key)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ HTTPS + SSL
             v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase                               â”‚
â”‚  â”œâ”€ Row Level Security (RLS)            â”‚
â”‚  â”œâ”€ ë°ì´í„° ì•”í˜¸í™” (at rest)             â”‚
â”‚  â””â”€ ë°±ì—… ë° ë³µêµ¬                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Service Role Key (ì„œë²„ë§Œ)
             v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI ë°±ì—”ë“œ                              â”‚
â”‚  â”œâ”€ ì—°í•©í•™ìŠµ (Federated Learning)       â”‚
â”‚  â”œâ”€ ì°¨ë¶„ í”„ë¼ì´ë²„ì‹œ (Differential)      â”‚
â”‚  â””â”€ ë™í˜• ì•”í˜¸í™” (ì„ íƒì‚¬í•­)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í”„ë¼ì´ë²„ì‹œ ë³´í˜¸ ê¸°ìˆ 

1. **ì—°í•©í•™ìŠµ (Federated Learning)**
   - ì›ë³¸ ë°ì´í„°ëŠ” ì„œë²„ë¡œ ì „ì†¡ ì•ˆ í•¨
   - ê° ë””ë°”ì´ìŠ¤ì—ì„œ ëª¨ë¸ í•™ìŠµ
   - í•™ìŠµëœ íŒŒë¼ë¯¸í„°ë§Œ ê³µìœ 

2. **ì°¨ë¶„ í”„ë¼ì´ë²„ì‹œ (Differential Privacy)**
   - ë°ì´í„°ì— ìˆ˜í•™ì  ë…¸ì´ì¦ˆ ì¶”ê°€
   - ê°œì¸ ì‹ë³„ ë¶ˆê°€ëŠ¥í•˜ê²Œ ì²˜ë¦¬

3. **ë°ì´í„° ë³´ê´€ ê¸°ê°„**
   - ë©”ì‹œì§€: 1ë…„ (ì´í›„ ìë™ ì‚­ì œ ì˜µì…˜)
   - ë¶„ì„ ê²°ê³¼: 2ë…„
   - ìŒì„± ì›ë³¸: ì¦‰ì‹œ ì‚­ì œ (í…ìŠ¤íŠ¸ ë³€í™˜ í›„)

---

## ì •ëŸ‰ì  ì„±ê³¼ ëª©í‘œ

| ì§€í‘œ | ëª©í‘œ | ì¸¡ì • ë°©ë²• |
|------|------|----------|
| ì‚¬ìš©ì ë§Œì¡±ë„ | 4.5ì /5ì  | NPS ì„¤ë¬¸ |
| ì¼ì • ë“±ë¡ ìë™í™”ìœ¨ | 80% ì´ìƒ | NER ì •í™•ë„ |
| ìƒˆë¡œìš´ ì£¼ì œ íƒìƒ‰ | ì›” 8ê°œ ì´ìƒ | topic_history ë¶„ì„ |
| í™œë™ ì‹¤í–‰ë¥  | 70% ì´ìƒ | activities.status='completed' |
| ê´€ê³„ ë§Œì¡±ë„ í–¥ìƒ | 25% ì´ìƒ | ë¶„ê¸°ë³„ ì„¤ë¬¸ (ì „í›„ ë¹„êµ) |

---

## í–¥í›„ ê°œì„  ì‚¬í•­

- [ ] **KoBERT ìì²´ í•™ìŠµ** - Gemini API ë¹„ìš© ì ˆê°
- [ ] **ìŒì„± í†¤ ë¶„ì„ ê³ ë„í™”** - ê°ì • ì¸ì‹ ì •í™•ë„ í–¥ìƒ
- [ ] **ì£¼ì œ ì„ë² ë”©** - Sentence Transformersë¡œ ìœ ì‚¬ ì£¼ì œ êµ°ì§‘í™”
- [ ] **ê°ˆë“± ì˜ˆì¸¡ ëª¨ë¸** - LSTM ê¸°ë°˜ ì‹œê³„ì—´ ì˜ˆì¸¡
- [ ] **ë‹¤êµ­ì–´ ì§€ì›** - ì˜ì–´, ì¼ë³¸ì–´ í™•ì¥
- [ ] **ì»¤í”Œ í˜ë¥´ì†Œë‚˜ ë¶„ì„** - MBTI ì—°ë™, ì„±ê²© ê¸°ë°˜ ì¶”ì²œ

---

## ê°œë°œ í™˜ê²½ ì„¤ì •

### AI ë°±ì—”ë“œ (Realtime Listener)
```bash
cd ai_backend
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# .env ì„¤ì •
cp .env.example .env
# SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY, GEMINI_API_KEY, OPENAI_API_KEY ì…ë ¥

# Realtime Listener ì‹¤í–‰ (ë©”ì¸)
python listener.py

# (ì„ íƒì‚¬í•­) FastAPI ì„œë²„ ì‹¤í–‰ (API í•„ìš”ì‹œ)
# python -m app.main
```

### Flutter ì•±
```bash
cd gemophia_app
flutter pub get

# .env ì„¤ì •
cp .env.example .env
# SUPABASE_URL, SUPABASE_ANON_KEY ì…ë ¥

# ì•± ì‹¤í–‰
flutter run
```

---

## ì°¸ê³  ë¬¸ì„œ

- [ê¸°íšì„œ](./2025ë…„_ìƒˆì‹¹_í•´ì»¤í†¤(AIì„œë¹„ìŠ¤ê¸°íšì„œ).pdf)
- [Supabase Realtime](https://supabase.com/docs/guides/realtime)
- [FastAPI](https://fastapi.tiangolo.com/)
- [KoBERT](https://github.com/SKTBrain/KoBERT)
- [Google Gemini API](https://ai.google.dev/docs)
- [GPT-4 API](https://platform.openai.com/docs/models/gpt-4)
